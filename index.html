<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pendulums!</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>N-body pendulum physics simulator</h1>
    <div id="controlsLine1">
        <button onclick="pause()" id="pauseButton">Play</button>
        <button onclick="addPointMass()">Add a particle</button>
        <button onclick="addRod()">Add a rod</button>
        <button onclick="save()">Save</button>
        <button onclick="load()">Load</button>
        <button onclick="clearObjects()">Clear</button>
        
    </div>

    <div id="controlsLine2">
        <div id="gravityContainer">
            <p>Gravity</p>
            <p><input type="range" min = "0" max = "200" value = "50" class="slider" id="gravitySlider"></p>
        </div>
    </div>

    <canvas id="myCanvas"></canvas>

    <script src="js/utils.js"></script>
    <script src="js/primitives/point.js"></script>
    <script src="js/primitives/segment.js"></script>
    <script src="js/pointMass.js"></script>
    <script src="js/rod.js"></script>
    <script src="js/controller.js"></script>
    <script>
        myCanvas.width = myCanvas.height = 400;
        const ctx = myCanvas.getContext("2d");

        gravitySlider.oninput = function() {controller.gravity = this.value};

        const controller = new Controller(myCanvas)

        function save() {
            localStorage.setItem("masses", JSON.stringify(controller.masses));
            localStorage.setItem("rods", JSON.stringify(controller.rods));
        }

        function load() {
            const info = {masses: JSON.parse(localStorage.getItem("masses")), rods: JSON.parse(localStorage.getItem("rods"))};
            controller.load(info);
        }

        function addPointMass() {
            controller.addPointMass();
        }

        function addRod() {
            controller.addRod();
        }

        function pause() {
            controller.pause();
        }

        function clearObjects() {
            controller.dispose();
        }
 
        let deltaTime = 0;
        let lastTime = 0;
        animate(0);
        function animate(timestamp) {
            deltaTime = timestamp - lastTime;
            lastTime = timestamp;
            ctx.clearRect(0, 0, myCanvas.width, myCanvas.height);

            controller.update(deltaTime)
            controller.draw()

            pauseButton.innerText = controller.paused ? "Play" : "Pause";
            
            requestAnimationFrame(animate)
        }
    </script>
</body>
</html>